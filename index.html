<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Virtual Companion ðŸ’–</title>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"></script>

<!-- PayPal SDK -->
<script src="https://www.paypal.com/sdk/js?client-id=ATu5-pUyxPXu8w9MIcPrLRbBUsKnN7-rK3VThNv6fznsulCgvVdAWA8GSQK91Jlh-vstzkfabe-CooSK&currency=USD"></script>

<!-- ElevenLabs Agent -->
<script src="https://unpkg.com/@elevenlabs/convai-widget-embed" async type="text/javascript"></script>

<style>
body {
  margin: 0;
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(180deg, #000000, #1a0f0f);
  color: #fff;
}
header {
  background: #000;
  padding: 20px;
  text-align: center;
  border-bottom: 2px solid #b76e79;
}
header h1 {
  color: #b76e79;
  margin: 0;
  font-size: 2rem;
}
.container {
  max-width: 600px;
  margin: 40px auto;
  background: #111;
  padding: 30px;
  border-radius: 12px;
  border: 1px solid #b76e79;
  box-shadow: 0 0 15px rgba(183,110,121,0.4);
}
input, textarea {
  width: 100%;
  padding: 12px;
  margin: 10px 0;
  border: none;
  border-radius: 8px;
  background: #222;
  color: #fff;
}
button {
  background: #b76e79;
  color: #fff;
  border: none;
  padding: 12px 20px;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}
button:hover { background: #cf8791; }
.chat-box {
  background: #000;
  height: 300px;
  overflow-y: auto;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  border: 1px solid #b76e79;
}
.message {
  margin: 8px 0;
  padding: 10px;
  border-radius: 8px;
  max-width: 80%;
}
.user { background: #b76e79; color: #fff; margin-left: auto; text-align: right; }
.bot { background: #222; color: #fff; margin-right: auto; text-align: left; }
footer {
  text-align: center;
  padding: 20px;
  color: #b76e79;
  font-size: 0.9rem;
}
</style>
</head>

<body>
<header>
  <h1>My Virtual Companion ðŸ’–</h1>
  <p>Chat â€¢ Voice â€¢ Connection</p>
</header>

<div class="container">
  <div id="authSection">
    <h2>Login / Sign Up</h2>
    <input id="email" type="email" placeholder="Email" />
    <input id="password" type="password" placeholder="Password" />
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign Up</button>
  </div>

  <div id="chatSection" style="display:none;">
    <h2>ðŸ’¬ Chat with Your Companion</h2>
    <div class="chat-box" id="chatBox"></div>
    <textarea id="messageInput" placeholder="Type your message..."></textarea>
    <button onclick="sendMessage()">Send</button>
    <div id="paypal-buttons" style="margin-top:20px;"></div>
  </div>
</div>

<footer>Â© 2025 My Virtual Companion | All Rights Reserved</footer>

<!-- ElevenLabs Voice Widget -->
<elevenlabs-convai agent-id="agent_01jyp6xnr8e7rrkdw5khw7fev2"></elevenlabs-convai>

<script>
// ---------------------- Firebase Init ----------------------
const firebaseConfig = {
  apiKey: "AIzaSyBw6Cnjnl7g2vC-RksvgR-0PNSkEYavoms",
  authDomain: "aigirlfriend-110b1.firebaseapp.com",
  projectId: "aigirlfriend-110b1",
  storageBucket: "aigirlfriend-110b1.firebasestorage.app",
  messagingSenderId: "1007677116277",
  appId: "1:1007677116277:web:08b6c629f8aa13ada7cd3c",
  measurementId: "G-G7S02Z709P"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;

// ---------------------- Auth Functions ----------------------
function login() {
  const email = emailInput.value;
  const password = passwordInput.value;
  auth.signInWithEmailAndPassword(email, password)
    .then(user => {
      currentUser = user.user;
      authSection.style.display = "none";
      chatSection.style.display = "block";
      loadChat();
    })
    .catch(e => alert(e.message));
}

function signup() {
  const email = emailInput.value;
  const password = passwordInput.value;
  auth.createUserWithEmailAndPassword(email, password)
    .then(user => {
      currentUser = user.user;
      authSection.style.display = "none";
      chatSection.style.display = "block";
    })
    .catch(e => alert(e.message));
}

// ---------------------- Chat Logic ----------------------
async function sendMessage() {
  const text = messageInput.value.trim();
  if (!text || !currentUser) return;
  const chatRef = db.collection("chats").doc(currentUser.uid).collection("messages");
  await chatRef.add({ sender: "user", text, createdAt: new Date() });
  addMessage("user", text);
  messageInput.value = "";
  const reply = "ðŸ’– I'm always here for you, tell me more...";
  await chatRef.add({ sender: "bot", text: reply, createdAt: new Date() });
  addMessage("bot", reply);
}

function addMessage(sender, text) {
  const msg = document.createElement("div");
  msg.className = "message " + sender;
  msg.textContent = text;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function loadChat() {
  if (!currentUser) return;
  const chatRef = db.collection("chats").doc(currentUser.uid).collection("messages").orderBy("createdAt");
  chatRef.onSnapshot(snapshot => {
    chatBox.innerHTML = "";
    snapshot.forEach(doc => addMessage(doc.data().sender, doc.data().text));
  });
}

// ---------------------- PayPal Buttons ----------------------
paypal.Buttons({
  style: { color: 'gold', shape: 'pill', label: 'pay' },
  createOrder: (data, actions) => {
    return actions.order.create({
      purchase_units: [{ amount: { value: '9.99' }, description: 'Basic Subscription' }]
    });
  },
  onApprove: (data, actions) => {
    return actions.order.capture().then(details => {
      alert('Thank you, ' + details.payer.name.given_name + '! Subscription activated.');
    });
  }
}).render('#paypal-buttons');
</script>
</body>
</html>
